# 在嵌入式系统中进行文件传输

如何在个人电脑和嵌入式系统中进行文件传输？有时需要将嵌入式系统其内部存储的文件拷贝到电脑上，或者将电脑上的文件拷贝到嵌入式系统中进行执行。应该如何做呢？

## 通过 USB 连接

手机就是一个嵌入式设备，经常会有手机通过 USB 数据线连接到电脑上的场景。电脑一般都会将手机识别成一个文件，此时的文件传输，只需要复制、粘贴即可。


## 使用 FTP 传输


### PC 做客户端，设备做服务端

准备条件：
1. 需要在嵌入式设备上安装并配置 FTP 服务器（如 `vsftpd`），具体可以参考[嵌入式设备中搭建本地FTP服务](嵌入式设备中搭建本地FTP服务.md)
2. 在个人电脑上安装 FTP 客户端（如 FileZilla ）或者 命令行

含 UI 传输步骤（Windows 系统常使用）：
1. 电脑上打开 FTP 客户端，输入嵌入式设备的 IP、端口（21）用户名和密码连接
2. 通过客户端界面进行文件的上传和下载

命令行传输步骤（Linux/MacOS）：
1. 在电脑终端上，输入命令:`ftp [服务器地址]`
2. 系统提示输入用户名和密码，输入后登录。或者`ftp -u [用户名] [服务器地址]`直接登录
3. 支持以下的命令：

        #下载文件，如果省略本地文件名，文件将以远程文件名保存到本地
        get [远程文件名] [本地文件名] 

        #批量下载文件
        mget [文件通配符]

        #上传文件，如果省略远程文件名，文件将以本地文件名上传到服务器。
        put [本地文件名] [远程文件名]

        #批量上传文件
        mput [文件通配符]

        #远程目录操作
        ls/cd/mkdir/rmdir

        #本地目录操作
        !ls/lcd

        #退出FTP会话
        quit 或 bye

### PC 做服务端，设备做客户端

准备条件：

1. 嵌入式设备上需要支持 FTP 客户端功能（安装或集成适当的 FTP 客户端软件或库如　libFTP.so）
2. 个人电脑上需要安装客户端（如 FileZilla Server）并配置。具体可以参考[FileZilla Server 配置　FTP　服务](#)

UI 传输：
1. 嵌入式设备在命令行中，输入命令`ftp [服务器地址]`，类似于上面的在电脑上使用 ftp 命令[](#)
2. 嵌入式设备的主进程中，集成了 libFTP.so，支持设备实现 FTP 客户端功能。
3. 在设备主进程中实现文件传输到 PC 的 FTP 服务端的功能，这种只能定制化。


## 使用 SFTP 客户端软件

> sftp

## 通过串口

## 挂载

# 挂载（共享Linux系统A和另一台服务器目录）

确保它们在同一个网段下
## 方法1：将系统B或C挂载到A的本地目录上，实现文件互传
### 另一台服务器为Linux系统B

假设原先的那台Linux系统为A，需要将B的`/data1/qintian/nfs/kafka`挂载到A的/mnt/nfs01/目录上，在A上执行

    mount -t nfs -o nolock hostB:/data1/qintian/nfs/kafka /mnt/nfs01/

`hostB`表示需要挂载的B的IP地址，`/mnt/msa1`表示将B的目录挂载到A的该目录下，这样就可以实现A和B之间的文件交互了。
之后使用

    umount /mnt/nfs01/

卸载A中已经挂载的目录

### 另一台服务器为Windows系统C

借助第三方软件freeNFS，指定一个Windows下的目录，在软件的server界面配置，例如`E:\nfs\test`,然后在A上执行

    mount -t nfs -o nolock hostC:/ /mnt/nfs01/

`hostC`表示Windows主机的IP地址，由于在freeNFS上面已经指定了C上需要挂载的目录，所以该处就无需手动输入完整路径
之后使用

    umount /mnt/nfs01/

卸载A中已经挂载的目录

如果Linux系统B挂载到了Windows系统C上，如B在C上映射为一个盘符X:/，可以同时使用两种方法进行挂载。如果在电脑C上挂载不上Linux系统B，那么就只能使用诸如freeNFS第三方软件挂载的方式进行挂载。

## 方法2：将A挂载到B上
### 使用SSHFS文件系统
SSHFS使得通过SSH协议将远程目录挂载到本地计算机上，允许在本地计算机上访问远程服务的文件。

在Linux系统上安装 SSHFS：

    sudo apt-get install sshfs

创建挂载点

    mkdir ~/remote_dir

挂载远程目录
    sshfs user@remote_host:/path/to/remote/dir ~/remote_dir
`user`是远程服务器的用户名，`remote_host`是远程服务器的地址，`/path/to/remote/dir`是远程服务器上要挂载的目录，`~/remote_dir`是本地的挂载点。

卸载远程目录

    fusermount -u ~/remote_dir


## 其他方法
### 连接Linux系统A的SSH
使用诸如SecureCRT、Xterm、Putty、Minicom 等终端仿真软件。这些软件支持ZMODEM协议，这是一种 终端-终端文件传输协议。

>`sz`:用于将文件从本地A发送到远程机器B或C

    sz filename

>`rz`:用于从远程机器B或C接收文件到本地A

    rz filename

### 使用SFTP协议支持文件传输
SFTP是一种SSH文件传输协议，可以用来连接远程服务器，浏览和传输文件。
对于Windows用户，支持的软件WinSCP和FileZilla。运行时选择SFTP协议，连接嵌入式Linux系统A，就可以直接浏览A的目录，将文件进行共享。
SFTP协议的默认端口是22，该文件的成功使用需要嵌入式系统A支持SFTP服务，即开启22端口。


