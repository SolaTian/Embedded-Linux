# 嵌入式系统常见通信协议

在嵌入式系统中，有一些被广泛应用的通信协议。下面就从`OSI`7层网络模型的角度来介绍常见的通信协议。

## 1、物理层

> 定义物理介质的传输方式，如电气信号、机械连接等。

### 1.1、`UART`

> `UART`（通用异步收发器）是一种异步串行通信的协议，它定义了数据传输的格式和同步方式，通过起始位和停止位实现数据帧的同步，不需要额外的时钟信号。

#### 1.1.1、`UART`的特点


|`UART`特点|说明|
|-|-|
|全双工通信|设备可以同时发送和接收数据。|
|异步传输|无需时钟信号<li>依靠预定的波特率协调收发双方的时序<li>通过起始位和停止位来标记数据帧的开始和结束|
|简单帧结构|主要参数就包括波特率、起始位（1位，低电平）、数据位（5-9位，通常为8位）、可选的奇偶校验位（1位）、停止位（1-2位，高电平）|
|流量控制|支持流量控制。<li>硬件流量通过`CTS`和`RTS`信号线来管理数据流<li>软件流量控制通过`XON`（继续）和`XOFF`（暂停）控制数据传输|


#### 1.1.2、`UART`和串口

> 串口: 通常包含`UART`模块和电器接口。

- `UART`控制器：是实现`UART`协议的核心硬件组件，负责将并行数据转换成为串行数据。
- 电器接口：负责将`UART`的`TTL`电平转换成特定的电器标准(如`RS-232/RS-485`)

串口在不同的平台上，设备管理器显示不同：

1. `Windows`: `COM1`、`COM2`...
2. `Linux/MacOS`: `/dev/ttyS0`、`/devttyUSB0`...

##### a、`RS232/RS485`

|电器标准|`RS232`|`RS485`|
|-|-|-|
|连接方式|1对1|1对多|
|传输距离|最大 15 米|最大 1200 米|
|抗干扰能力|弱|强|

##### b、波特率

通过串口通信的双方，需要保持波特率（每秒传输的`bit` 数）的一致，否则数据的接收就会出现乱码。

#### 1.1.3、`UART`的应用场景

1. 调试接口：嵌入式系统通过串口连接电脑，在电脑上通过特定软件输出调试信息。
2. 设备控制：嵌入式系统通过串口控制`PLC`，`LED`显示屏等。
3. 数据采集：嵌入式系统通过串口接收传感器的数据，并进行处理。

### 1.2、`SPI`

> `SPI`（串行外设接口）是一种同步串行通信接口，用于

### 1.3、`I2C`

## 2、数据链路层

## 3、网络层

## 4、传输层

## 5、会话层

## 6、表示层

## 7、应用层

## 并行通信与串行通信

|通信分类|说明|距离|
|-|-|-|
|并行通信|同时使用多条数据线，一次传输多个比特（通常是8位、16位、32位）|<li>数据总线/地址总线（`MCU`内部）: `MCU`访问外部`SRAM`/`Flash` 等等|
|串行通信|使用1~2根数据线，数据一位一位顺序传输|<li> `UART`:串口通信、调试信息打印 <li> `SPI`: 传感器、Flash、显示屏等高速通信 <li> `I²C`: 多设备总线通信，如 `EEPROM`、`RTC`<li> `USB、CAN、Ethernet`: 外设连接、高速通信、网络|


### 为什么需要串行通信

主要有以下几点原因：

1. 嵌入式芯片引脚有限，比如 `MCU` 只有几十根 `IO`，并行通信会占用大量`IO`口（如并行`LCD`通常要20+线），而串行 `SPI/I²C` 只需几根。

2. 并行线切换频繁，电磁干扰大；串行通信信号变化少，更安静、能耗低。


