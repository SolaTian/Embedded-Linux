# 1、vi与vim

所有的 UNIX Like系统都会内置vi文本编辑器，其他的文本编辑器不一定存在

vim是vi的高级版本，vim会根据文件的扩展名或者文件内的开头信息，判断该文件的内容，而自动调用该程序的语法判断式。以颜色来显示程序代码和一般信息。

# 2、`vi`的使用

|`vi`模式|说明|
|-|-|
|一般模式|`vi`打开一个文件就直接进入了一般模式，可以上下左右移动光标，可以删除字符或者删除整行，也可以复制粘贴文件数据|
|编辑模式|一般模式无法编辑文件内容，按下`"i"`,`"I"`,`"o"`,`"O"`,`"a"`,`"A"`,`"r"`,`"R"`任何一个字母进入编辑模式，左下方会出现`INSERT`或者`REPLACE`，回到一般模式，需要按下`Esc`|
|命令行模式|输入`:`,`/`,`?`中的任何一个，将光标移动到最下面那一行，可以进行查找数据，读取，保存，大量替换字符，离开`vi`，显示行号等操作|

## 2.1 操作范例

   [root@www ~]# vi 文件名(不管文件存在与否) 

## 2.2 按键说明

**<font size = 5 color =red>`一般模式`</font>**
|移动光标|说明|
|-|-|
|`h`或`←`|光标左移一个字符|
|`j`或`↓`|光标下移一个字符|
|`k`或`↑`|光标上移一个字符|
|`l`或`→`|光标右移一个字符|
|`Ctrl+f`|屏幕向下移动一页，相当于`Page Down`|
|`Ctrl+b`|屏幕向上移动一页，相当于`Page Up`|
|`+`|光标移动到非空格的下一行|
|`-`|光标移动到非空格的下一行|
|`n+space`|按下数字再按下空格键，光标会向右移动到这一行的n个字符|
|`0`|移动到这一行的最前面处|
|`$`|移动到这一行的最后面处|
|`G`|光标移动到这个文件的最后一行|
|`nG`|移动到文件的第n行|
|`gg`|移动到文件的第一行|
|`n+Enter`|光标向下移动n行|

|查找、替换|说明|
|-|-|
|`/word`|向下寻找名称为`word`的字符串|
|`?word`|向上寻找名称为`word`的字符串|
|`n`|代表重复上一个查找的操作|
|`N`|代表反向进行前一个查找操作，原先向下查找，按下`N`就变成向上查找|
|`:n1,n2s/word1/word2/g`|在n1和n2行之间，寻找`word1`这个字符串，并用`word2`这个字符串进行替换|
|`:1,$s/word1/word2/g`|从第一行到最后一行查找`word1`字符串，并将该字符串替换为`word2`|
|`:1,$s/word1/word2/gc`|从第一行到最后一行查找`word1`字符串，并将该字符串替换为`word2`,并且在替换前提示用户确认|

`/word`配合`n`和`N`,比较常用。

|删除、复制与粘贴||
|-|-|
|`x`,`X`|在一行字中，`x`为向后删除一个字符，`X`为向前删除一个字符|
|`nx`|`n`为数字，连续向后删除`n`个字符|
|`dd`|删除光标所在的一整行(常用)|
|`ndd`|`n`为数字，删除光标所在的向下`n`行(常用)|
|`d1G`|删除光标所在行到第一行的所有数据|
|`dG`|删除光标所在行到最后一行的所有数据|
|`d$`|删除光标所在处到该行的最后一个字符|
|`d0`|删除光标所在处到该行的最前面的一个字符|
|`yy`|复制光标所在的那一行(常用)|
|`nyy`|复制光标所在的向下`n`行(常用)|
|`y1G`|复制光标所在行到第一行的所有数据|
|`yG`|复制光标所在行到最后一行的所有数据|
|`y0`|复制光标所在的那个字符到该行行首的所有数据|
|`y$`|复制光标所在的那个字符到该行行尾的所有数据|
|`p`，`P`|`p`为将已经复制的数据在光标下一行进行粘贴，`P`为粘贴在光标的上一行(常用)|
|`J`|将光标所在行与下一行的数据结合成同一行|
|`c`|重复删除多个数据，例如向下删除10行[10cj]|
|`u`|复原前一个操作(常用)|
|`Ctrl+r`|重做上一个操作(常用)|
|`.`|重复前一个操作(常用)|

**<font size = 5 color =red>`编辑模式`</font>**

|按键|说明|
|-|-|
|`i`,`I`|进入插入模式，`i`为光标所在处进行插入，`I`为目前所在行的第一个非空格符开始插入(常用)|
|`a`,`A`|进入插入模式，`a`为从目前光标所在的下一个字符开始插入，`A`为从光标所在处的最后一个字符处开始插入(常用)|
|`o`,`O`|进入插入模式，`o`为在目前光标所在的下一行插入新的一行；`O`为在目前光标所在处的上一行插入新的一行(常用)|
|`r`,`R`|进入替换模式，`r`只会替换光标所在的那一个字符一次，`R`会一直提黄光标所在的文字，直到按下`Esc`(常用)|
|`Esc`|退出编辑模式，回到一般模式|




**<font size = 5 color =red>`命令行模式`</font>**

|按键|说明|
|-|-|
|`:w`|将编辑的数据写入硬盘文件|
|`:w!`|若文件为只读，则强制写入该文件，不过能不能写入，与用户对该文件的权限有关|
|`:q`|离开`vi`|
|`:q!`|强制离开，且不保存文件|
|`:wq`|保存之后离开|
|`ZZ`|若文件没有变更，则不保存离开，若文件变更，则保存后离开|
|`:w [filename]`|将编辑的数据保存文件，类似于另存为|
|`:r [filename]`|在编辑的数据中，读取另一个文件的数据，将[filename]的数据追加到光标所在行的后面|
|`:n1,n2 w [filename]`|将`n1`到`n2`行的数据保存成为[filename]这个文件|
|`:!command`|暂时离开`vi`到命令行模式下执行`command`的显示结果，例如`:!ls /home`可以在`vi`中查看`/home`下面的`ls`输出的文件信息|
|`:set nu`|显示行号，设置后在每行行前显示行号|
|`:set nonu`|取消行号|


## 2.3 `vim`的保存文件、恢复与打开时的警告信息

当使用`vim`编辑的时候，`vim`会在被编辑文件的目录下新建一个文件名同名的`.filename.swp`的暂存文件，如果`vim`的工作被不正常中断，就可以使用这个暂存文件去进行操作，当再次使用`vim`打开原始文件的时候会提示有暂存文件的存在，可以做以下操作

- `O`:打开原始文件为只读文件
- `E`:用正常的方式打开要编辑的文件，并不会载入暂存文件的内容，不过容易出现连个用户相互改变对方文件的内容
- `R`:加载暂存文件的内容，用于救回之前未被保存的工作，救回保存之后，手动删除那个暂存文件
- `D`:确定暂存文件无用，打开文件之前将这个暂存文件删除(常用)
- `Q`:按下离开`vim`，不进行任何操作
- `A`:忽略这个编辑行为，与`quit`相似

# 3、`vim`的功能

现在`vim`基本已经代替了`vi`，具有颜色显示的功能，且会自动显示行号。

`vim`的用法与`vi`完全一样

    [root@www ~]# vim filename


## 3.1 块选择`Visual Block`

之前的操作都是以行为单位，还可以以块为单位来处理文件

一般模式下可以有以下按键

|块选择按键|说明|
|-|-|
|`v`|字符选择，将光标经过的地方反白选择|
|`V`|行选择，将光标经过的行反白选择|
|`Ctrl+v`|块选择，可以用长方形的方式选择数据|
|`y`|将反白的地方复制起来|
|`d`|将反白的地方删除|


## 3.2 多文件编辑

`vim`后面可以接几个文件同时编辑，可以将一个文件的内容复制到另外一个文件里

命令行模式下有以下按键

|按键|说明|
|-|-|
|`:n`|编辑下一个文件|
|`:N`|编辑上一个文件|
|`:files`|列出`vim`打开的所有文件|


## 3.3 多窗口功能

当有一个大文件，在查看后面的数据时，需要对照前面的数据；或者有两个文件需要对照查看，又不使用多文件编辑。可以使用多窗口功能

在命令行模式下

|按键|说明|
|-|-|
|`:sp [filename]`|打开一个新窗口，如果有加`filename`，表示在窗口打开一个新文件，否则表示两个窗口为同一个文件内容(同步显示)|
|`Ctrl+w+j`或者`Ctrl+w+↓`|按法为，先按住`Ctrl`不放，然后按下`w`后松开所有的按键，再按下`j`或者`↓`，则光标可以移动到下方的窗口|
|`Ctrl+w+k`或者`Ctrl+w+↑`|按法同上，光标移动到上方的窗口|
|`Ctrl+w+q`|其实就是`:q`结束离开，可以通过上面的方法移动到对应的窗口，然后按下`:q`或者`Ctrl+w+q`离开|

## 3.4 `vim`的环境设置与记录:`~/.vimrc`，`~/.viminfo`

当我们使用`vim`查找字符串时，字符串就会反白，甚至下次打开这个文件或者打开下一个文件的时候都会反白，是因为`vim`将这一行为记录下来，在`~/.viminfo`这个文件。

`vim`的环境设置参数很多，可以在命令行模式下输入`:set all`来查阅，下面给出一些常用的参数

|命令|说明|
|-|-|
|`:set nu`/`:set nonu`|设置和取消行号|
|`:set hlsearch`/`:set nohlsearch`|设置是否将查找的字符串反白的设置值，默认是`hlsearch`|
|`:set autoindent`/`:set nosutoindent`|是否设置自动缩排|
|`:set backup`|表示是否自动保存备份文件，一般是`nobackup`，如果设置`backup`，则在编辑文件`filename`时，会在同目录下，就会产生`filename~`的文件，记录原始`filename`的文件内容。|
|`:set ruler`|设置是否显示右下角的状态栏说明|
|`:set showmode`|设置是否要显示`--INSERT--`之类的字眼在左下角而状态栏|
|`:set backspace=(012)`|进入一般模式后，一般可以通过`backspace`退格键来删除任意字符，但是有的版本不允许，可以通过该项来设置，当`backspace`为2时就可以删除任意值，为0或者1时，仅可以删除刚才输入的字符，不能删除已经存在的文本|
|`:set all`|显示目前所有的环境参数设置值|
|`:set`|显示与系统默认值不同的设置参数，一般就是自行变动过的参数|
|`:syntax on`/`syntax off`|表示是否开启程序相关语法显示不同的颜色|
|`:set bg=dark`/`:set bg=light`|显示不同的颜色色调，默认是`light`|


整个`vim`的配置文件一般是放置在`/etc/vimrc`中，一般不建议修改，可以修改`~/.vimrc`这个文件(默认不存在，需要手动创建)，将所需要的设置值写入

    [root@www ~]# vim ~/.vimrc
    "-这个文件的双引号
    “-这个文件的批注
    set hlsearch               ”高亮度反白
    set backspace=2            “可随时使用退格键删除
    set autoinden              "自动缩排
    set ruler                  "可显示最后一行的状态
    set showmode               "左下角那一行的状态
    set nu                     "可以在每一行的最前面显示行号
    set bg=dark                "显示不同的底色色调
    syntax on                  "进行语法检验，颜色显示

创建好这个文件之后，下次重新以`vim`编辑某个文件时，该文件的默认环境就是这么设置的


# 4、其他`vim`使用事项

## 4.1 语系编码转换`iconv`

    [root@www ~]# iconv --list
    [root@www ~]# iconv -f 原本编码 -t 新编码 filename [-o newfile]

- `--list`:列出 iconv 支持的语系编码
- `-f`:原本的编码格式
- `-t`:新的编码格式
- `-o file`:如果要保留原来的文件，则使用`-o 新文件名`,建立新的文件

示例

    [root@www ~]# cd /tmp/vitest
    [root@www vitest]# iconv -f big5 -t utf8 vi.big5 -o vi.utf8
    [root@www vitest]# file vi*
    vi.big5: ISO-8859 text, with CRLF line terminators
    vi.utf8: UTF-8 Unicode text, with CRLF line terminators
